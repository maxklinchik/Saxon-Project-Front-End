<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings - Strike Master</title>
  <link rel="stylesheet" type="text/css" href="/main-pages/style.css">
  <link rel="stylesheet" type="text/css" href="/scripts/stored-colors.css">
  <script src="/scripts/accent-loader.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      background: var(--bg-color);
    }

    /* Sidebar */
    .sidebar {
      width: 200px;
      background: var(--main-color);
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px 0;
    }

    .sidebar a {
      background: none;
      border: none;
      color: white;
      padding: 15px 20px;
      text-align: left;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      display: block;
    }

    .sidebar a:hover {
      background: color-mix(in srgb, var(--accent-color) 50%, black);
    }

    .sidebar a.active {
      background: var(--accent-color);
    }

    /* Main content */
    .content {
      flex: 1;
      padding: 30px;
      background: var(--bg-color);
      overflow-y: auto;
      color: var(--text-color);
    }

    h2 {
      margin-top: 0;
    }

    .team-list {
      list-style: none;
      padding-left: 0;
    }

    .team-list li {
      padding: 8px 12px;
      background: white;
      margin-bottom: 8px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .team-list button {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .add-team {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .add-team input {
      flex: 1;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .add-team button {
      background: var(--accent-color);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .add-team button:hover {
      background: color-mix(in srgb, var(--accent-color) 50%, black);
    }

    #logoutBtn {
      margin-top: auto;
      color: rgb(235, 76, 76);
      background: none;
      border: none;
      padding: 15px 20px;
      text-align: left;
      font-size: 16px;
      cursor: pointer;
    }

    #logoutBtn:hover {
      background: #391f00;
    }

    /* X icon */
    .close-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      color: #333;
      text-decoration: none;
      font-weight: bold;
      padding: 20px;
    }

    .close-icon:hover {
      color: red;
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <a href="appearanceSettings.html">Appearance</a>
    <a href="teamsSettings.html" class="active">Teams</a>
    <a href="accountInfo.html">Account Info</a>
    <button id="logoutBtn">Logout</button>
  </div>

  <div class="content">
    <a href="/main-pages/teamSelector.html" class="close-icon">X</a>

    <div id="teams" class="section">
      <h2>Teams</h2>
      <ul id="teamList" class="team-list"></ul>

      <div class="add-team">
        <input type="text" id="newTeamInput" placeholder="Enter new team name" />
        <button id="addTeamBtn">Add Team</button>
      </div>
    </div>
  </div>

  <script>
const buttons = document.querySelectorAll('.sidebar button[data-section]');
const sections = document.querySelectorAll('.section');

buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    buttons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    sections.forEach(section => section.style.display = 'none');
    document.getElementById(btn.dataset.section).style.display = 'block';
  });
});

// -----------------------------
// Teams functionality
// -----------------------------
const teamList = document.getElementById('teamList');
const addTeamBtn = document.getElementById('addTeamBtn');
const newTeamInput = document.getElementById('newTeamInput');

let teams = [];

// Load teams from backend
async function loadTeams() {
  try {
    const res = await fetch("http://127.0.0.1:5000/api/teams");
    teams = await res.json();
    renderTeams();
  } catch (err) {
    console.error("Failed to load teams:", err);
  }
}

// Render team list
function renderTeams() {
  teamList.innerHTML = "";
  teams.forEach(team => {
    const li = document.createElement('li');
    li.textContent = team.name;

    const removeBtn = document.createElement('button');
    removeBtn.textContent = 'Remove';
    removeBtn.onclick = async () => {
      try {
        const res = await fetch(`http://127.0.0.1:5000/api/teams/${encodeURIComponent(team.name)}`, {
          method: 'DELETE'
        });
        if (res.ok) {
          loadTeams(); // reload list
        } else {
          const data = await res.json();
          alert(data.error || 'Failed to delete team');
        }
      } catch (err) {
        console.error("Delete team failed:", err);
      }
    };

    li.appendChild(removeBtn);
    teamList.appendChild(li);
  });
}

// Add new team
addTeamBtn.addEventListener('click', async () => {
  const name = newTeamInput.value.trim();
  if (!name) return alert('Enter a team name');

  try {
    const res = await fetch("http://127.0.0.1:5000/api/teams", {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name })
    });

    const data = await res.json();
    if (!res.ok) {
      alert(data.error || 'Failed to add team');
      return;
    }

    newTeamInput.value = '';
    loadTeams(); // reload from backend
  } catch (err) {
    console.error("Failed to add team:", err);
  }
});

// -----------------------------
// Logout button
// -----------------------------
document.getElementById('logoutBtn').addEventListener('click', () => {
  alert('Logging out...');
  // Implement actual logout logic here
});

// Load teams initially
loadTeams();
</script>


</body>
</html>
