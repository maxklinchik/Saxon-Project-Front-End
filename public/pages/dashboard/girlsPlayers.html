<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Strike Master - Players</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" type="text/css" href="/scripts/stored-colors.css">
  <script src="/scripts/accent-loader.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      text-align: center;
    }

    /* Main */
    .container {
      max-width: 700px;
      margin: 40px auto;
      background: var(--card-bg);
      padding: 25px;
      border-radius: 12px;
      border: 2px solid var(--accent-color);
    }

        /* Split button container */
    .split-button {
      display: flex;
      width: 300px;
      height: 40px;
      border-radius: 20px;
      overflow: hidden;
      border: 2px solid #fff;
      margin-left: 40px;
    }

    .split-button a {
      flex: 1;
      text-decoration: none;
      color: var(--main-color);
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }

    /* Left side */
    .girls {
      background-color: #b2b2b2;
    }

    .girls:hover {
      background-color: #929292;
    }

    /* Right side */
    .boys {
      background-color: #b2b2b2;
    }

    .boys:hover {
      background-color: #929292;
    }

    button {
      background-color: var(--accent-color); /* brown */
      color: white;
      border: none;
      padding: 10px 18px;
      margin: 8px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: var(--acccent-color-hover); /* orange */
    }

    .player-list {
      margin-top: 20px;
      text-align: left;
      position: relative;
    }

    .player-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
      position: relative;
    }

    .options-btn {
      cursor: pointer;
      font-size: 20px;
      padding: 4px 10px;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .options-btn:hover {
      background: #ddd;
    }

    .options-menu {
      position: absolute;
      right: 15px;
      top: 40px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: none;
      flex-direction: column;
      z-index: 10;
    }

    .options-menu button {
      background: none;
      color: #000;
      border: none;
      padding: 10px 15px;
      text-align: left;
      cursor: pointer;
    }

    .options-menu button:hover {
      background: #f0f0f0;
    }

    .split-button a.active { 
      filter: brightness(75%); 
    }
</style>
</head>
<body>
  <div class="navbar">
    <!-- Logo image that links to index.html -->
    <a href="index.html" class="logo">
      <img src="/images/phLogo.png" alt="Strike Master Logo">
    </a>

    <div class="split-button">
      <a href="boysPlayers.html" class="boys">Boys</a>
      <a href="girlsPlayers.html" class="girls">Girls</a>
    </div>

    <div class="nav-links">
      <a href="teamSelector.html">Team Selector</a>
      <a href="boysRecords.html">Records</a>
      <a href="girlsPlayers.html">Players</a>
      <a href="/settings/appearanceSettings.html">Settings</a>
      <a href="myTeam.html">My Team</a>
    </div>
  </div>

  <div class="container">
    <h1>Players</h1>
    <p>Add and remove players. These players will appear in the Records tab tables.</p>

    <input id="playerInput" type="text" placeholder="Enter player name" style="padding: 8px; width: 60%;" />
    <button id="addPlayerBtn">Add Player</button>

    <div class="player-list" id="playerList"></div>
  </div>

<script>
  let teacherAccess = true; // Set to false to disable adding/removing players
  let players = [];

  const currentPage = window.location.pathname; 
  if (currentPage.includes("boysPlayers.html")) { 
    document.querySelector(".boys").classList.add("active"); 
  }
  else if (currentPage.includes("girlsPlayers.html")) { 
    document.querySelector(".girls").classList.add("active"); 
  }


  // -----------------------
  // Load players from Flask
  // -----------------------
  async function loadPlayers() {
    try {
      const res = await fetch("http://127.0.0.1:5000/api/players");
      players = await res.json();
      renderPlayers();
    } catch (err) {
      console.error("Failed to load players:", err);
    }
  }

  // -----------------------
  // Render Players List
  // -----------------------
function renderPlayers() {
  playerList.innerHTML = "";

  players.forEach((player, index) => {
    const item = document.createElement("div");
    item.className = "player-item";

    const name = document.createElement("span");
    name.textContent = player.name;

    // Three-dot menu button
    const menuBtn = document.createElement("button");
    menuBtn.textContent = "â‹®";
    menuBtn.style.background = "transparent";
    menuBtn.style.color = "black";
    menuBtn.style.fontSize = "20px";
    menuBtn.style.border = "none";
    menuBtn.style.cursor = "pointer";

    // Dropdown menu container
    const menu = document.createElement("div");
    menu.style.position = "absolute";
    menu.style.background = "white";
    menu.style.border = "1px solid #ddd";
    menu.style.borderRadius = "6px";
    menu.style.padding = "8px 0";
    menu.style.minWidth = "120px";
    menu.style.boxShadow = "0 4px 10px rgba(0,0,0,0.15)";
    menu.style.display = "none";
    menu.style.zIndex = "10";
    menu.style.right = "15px";
    menu.style.top = "40px";

    // View profile option (always available)
    const profileOpt = document.createElement("div");
    profileOpt.textContent = "View Profile";
    profileOpt.style.padding = "8px 12px";
    profileOpt.style.cursor = "pointer";
    profileOpt.onmouseover = () => (profileOpt.style.background = "#eee");
    profileOpt.onmouseout = () => (profileOpt.style.background = "white");
    profileOpt.onclick = () => {
      window.location.href = `playerProfile.html?name=${encodeURIComponent(player.name)}`;
    };
    menu.appendChild(profileOpt);

    // Only add "Remove Player" if teacherAccess is true
    if (teacherAccess) {
      const removeOpt = document.createElement("div");
      removeOpt.textContent = "Remove Player";
      removeOpt.style.padding = "8px 12px";
      removeOpt.style.cursor = "pointer";
      removeOpt.onmouseover = () => (removeOpt.style.background = "#eee");
      removeOpt.onmouseout = () => (removeOpt.style.background = "white");
      removeOpt.onclick = () => removePlayer(player.name);
      menu.appendChild(removeOpt);
    }

    // Toggle menu show/hide
    menuBtn.onclick = (e) => {
      e.stopPropagation();
      menu.style.display = menu.style.display === "none" ? "block" : "none";
    };

    // Hide if user clicks anywhere else
    document.addEventListener("click", () => {
      menu.style.display = "none";
    });

    item.style.position = "relative";
    item.appendChild(name);
    item.appendChild(menuBtn);
    item.appendChild(menu);

    playerList.appendChild(item);
  });
}

  // -----------------------
  // Add Player
  // -----------------------
async function addPlayer() {
  const name = playerInput.value.trim();
  if (!name) return alert("Enter a valid player name");

  try {
    const res = await fetch("http://127.0.0.1:5000/api/players", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name }),
    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.error || "Failed to add player");
      return;
    }

    playerInput.value = "";
    loadPlayers(); // reload updated list
  } catch (err) {
    console.error("Add player failed:", err);
  }
}

  // -----------------------
  // Remove Player
  // -----------------------
  async function removePlayer(name) {
    try {
      const res = await fetch(`http://127.0.0.1:5000/players/${encodeURIComponent(name)}`, {
        method: "DELETE",
      });

      const data = await res.json();

      if (!res.ok) {
        alert(data.error);
        return;
      }

      loadPlayers();
    } catch (err) {
      console.error("Remove player failed:", err);
    }
  }

  const container = document.querySelector(".container");
  const playerInput = document.getElementById("playerInput");
  const addPlayerBtn = document.getElementById("addPlayerBtn");

  if (!teacherAccess) {
      // Hide input and button
      playerInput.remove();
      addPlayerBtn.remove();

      // Remove instruction paragraph
      const paragraph = container.querySelector("p");
      if (paragraph) paragraph.remove();
  }

  // -----------------------
  // Event listener
  // -----------------------
  addPlayerBtn.addEventListener("click", addPlayer);

  // -----------------------
  // Load on startup
  // -----------------------
  loadPlayers();
</script>
</body>
</html>